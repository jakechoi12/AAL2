<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bidding List - AAL Platform</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components/header.css">
    <link rel="stylesheet" href="../css/sections/bidding-list.css">
</head>
<body>
    <!-- Header -->
    <header>
        <a href="../ai_studio_code_F2.html" class="logo">
            AAL<span>.</span>
            <div class="full-name">All About Logistics</div>
        </a>
        <nav>
            <ul>
                <li><a href="quotation.html">Quotation</a></li>
                <li><a href="bidding-list.html" class="active">Bidding</a></li>
                <li><a href="market-data.html">Market Data</a></li>
                <li><a href="news-intelligence.html">News Intel</a></li>
                <li><a href="../ai_studio_code_F2.html#tools">Tools</a></li>
                <li><a href="report-insight.html">Report & Insight</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container section-padding">
        <!-- Page Header -->
        <div class="section-header">
            <div>
                <p class="section-subtitle">FREIGHT BIDDING PLATFORM</p>
                <h1 class="section-title">Bidding List</h1>
            </div>
            <div id="forwarderActions">
                <!-- Login/Register or User Info will be inserted here -->
            </div>
        </div>

        <!-- Forwarder Info Bar (shown when logged in) -->
        <div id="forwarderBar" class="forwarder-bar" style="display: none;">
            <div class="forwarder-info">
                <div class="forwarder-avatar" id="forwarderAvatar">F</div>
                <div class="forwarder-details">
                    <h4 id="forwarderCompany">Company Name</h4>
                    <span id="forwarderEmail">email@company.com</span>
                </div>
            </div>
            <button class="btn-logout" onclick="BiddingList.logout()">
                <i class="fas fa-sign-out-alt"></i> 로그아웃
            </button>
        </div>

        <!-- Dashboard Stats -->
        <div class="bidding-dashboard">
            <div class="stat-card total">
                <div class="stat-label">
                    <i class="fas fa-th-list"></i>
                    전체 BIDDING
                </div>
                <div class="stat-value" id="statTotal">-</div>
            </div>
            <div class="stat-card open">
                <div class="stat-label">
                    <i class="fas fa-gavel"></i>
                    진행중
                </div>
                <div class="stat-value" id="statOpen">-</div>
            </div>
            <div class="stat-card closing">
                <div class="stat-label">
                    <i class="fas fa-clock"></i>
                    마감예정 (24h)
                </div>
                <div class="stat-value" id="statClosing">-</div>
            </div>
            <div class="stat-card awarded">
                <div class="stat-label">
                    <i class="fas fa-trophy"></i>
                    낙찰완료
                </div>
                <div class="stat-value" id="statAwarded">-</div>
            </div>
            <div class="stat-card failed">
                <div class="stat-label">
                    <i class="fas fa-times-circle"></i>
                    유찰
                </div>
                <div class="stat-value" id="statFailed">-</div>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="filter-group">
                <select class="filter-select" id="filterStatus">
                    <option value="">전체 상태</option>
                    <option value="open">진행중</option>
                    <option value="closed">마감</option>
                    <option value="awarded">낙찰</option>
                    <option value="expired">만료</option>
                    <option value="cancelled">취소</option>
                </select>
                <select class="filter-select" id="filterShipping">
                    <option value="">전체 운송</option>
                    <option value="ocean">Ocean</option>
                    <option value="air">Air</option>
                    <option value="truck">Truck</option>
                </select>
                <input type="text" class="filter-input" id="filterSearch" placeholder="Bidding No 검색...">
            </div>
            <button class="btn-refresh" onclick="BiddingList.refresh()">
                <i class="fas fa-sync-alt"></i>
                새로고침
            </button>
        </div>

        <!-- Bidding Table -->
        <div class="bidding-table-container">
            <table class="bidding-table">
                <thead>
                    <tr>
                        <th>Bidding No</th>
                        <th>화주사</th>
                        <th>구간</th>
                        <th>운송타입</th>
                        <th>ETD</th>
                        <th>마감일시</th>
                        <th>상태</th>
                        <th>입찰기업</th>
                        <th>입찰참여</th>
                    </tr>
                </thead>
                <tbody id="biddingTableBody">
                    <!-- Table rows will be inserted here -->
                </tbody>
            </table>
            
            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <i class="fas fa-inbox"></i>
                <h3>등록된 입찰 건이 없습니다</h3>
                <p>새로운 견적 요청이 등록되면 여기에 표시됩니다.</p>
            </div>
            
            <!-- Loading State -->
            <div class="loading-spinner" id="loadingState" style="display: none;">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <!-- Pagination will be inserted here -->
        </div>
    </main>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="authModalTitle">포워더 로그인</h3>
                <button class="modal-close" onclick="BiddingList.closeAuthModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Login Form -->
                <div id="loginForm">
                    <div class="form-group">
                        <label class="form-label required">이메일</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="company@example.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">비밀번호</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="비밀번호를 입력하세요">
                    </div>
                    <p class="form-hint" style="margin-bottom: 1rem;">
                        등록된 이메일로 로그인하세요. 
                        <a href="#" onclick="BiddingList.showRegisterForm()" style="color: var(--accent-color);">
                            신규 등록하기
                        </a>
                    </p>
                </div>
                
                <!-- Register Form -->
                <div id="registerForm" style="display: none;">
                    <div class="form-group">
                        <label class="form-label required">회사명</label>
                        <input type="text" class="form-input" id="regCompany" placeholder="회사명">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">담당자명</label>
                            <input type="text" class="form-input" id="regName" placeholder="담당자명">
                        </div>
                        <div class="form-group">
                            <label class="form-label">사업자등록번호</label>
                            <input type="text" class="form-input" id="regBusinessNo" placeholder="000-00-00000">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">이메일</label>
                        <input type="email" class="form-input" id="regEmail" placeholder="company@example.com">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">비밀번호</label>
                            <input type="password" class="form-input" id="regPassword" placeholder="최소 6자 이상">
                        </div>
                        <div class="form-group">
                            <label class="form-label required">비밀번호 확인</label>
                            <input type="password" class="form-input" id="regPasswordConfirm" placeholder="비밀번호 확인">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">연락처</label>
                        <input type="tel" class="form-input" id="regPhone" placeholder="010-0000-0000">
                    </div>
                    <p class="form-hint">
                        이미 계정이 있으신가요? 
                        <a href="#" onclick="BiddingList.showLoginForm()" style="color: var(--accent-color);">
                            로그인하기
                        </a>
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn secondary" onclick="BiddingList.closeAuthModal()">취소</button>
                <button class="action-btn primary" id="authSubmitBtn" onclick="BiddingList.submitAuth()">
                    로그인
                </button>
            </div>
        </div>
    </div>

    <!-- Bid Submit Modal (Quote Registration - 견적 등록) -->
    <div class="modal-overlay bid-modal" id="bidModal">
        <div class="modal-content quote-reg-modal">
            <!-- 헤더: Bidding No + Deadline -->
            <div class="modal-header quote-header">
                <div class="header-left">
                    <h3 class="modal-title">견적 등록</h3>
                    <span class="modal-bidding-no" id="bidModalBiddingNo">EXSEA00000</span>
                </div>
                <div class="header-deadline">
                    <i class="fas fa-clock"></i>
                    <span class="deadline-label">Deadline</span>
                    <span class="deadline-datetime" id="headerDeadline">-</span>
                    <span class="deadline-dday" id="headerDday">D-0</span>
                </div>
                <button class="modal-close" onclick="BiddingList.closeBidModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <!-- Request Information (통합 그리드) -->
                <section class="qr-section request-info-section">
                    <h4 class="qr-section-title">Request Information</h4>
                    <div class="request-info-grid">
                        <div class="info-cell">
                            <span class="cell-label">Customer</span>
                            <span class="cell-value" id="reqCustomer">-</span>
                        </div>
                        <div class="info-cell">
                            <span class="cell-label">Trade</span>
                            <span class="cell-value" id="reqTradeMode">-</span>
                        </div>
                        <div class="info-cell">
                            <span class="cell-label">Shipping</span>
                            <span class="cell-value highlight" id="reqShippingMode">-</span>
                        </div>
                        <div class="info-cell">
                            <span class="cell-label">Load Type</span>
                            <span class="cell-value" id="reqLoadType">-</span>
                        </div>
                        <div class="info-cell">
                            <span class="cell-label">Incoterms</span>
                            <span class="cell-value" id="reqIncoterms">-</span>
                        </div>
                        <div class="info-cell">
                            <span class="cell-label">DG</span>
                            <span class="cell-value" id="reqDG">-</span>
                        </div>
                        <div class="info-cell span-3">
                            <span class="cell-label">Origin (POL)</span>
                            <span class="cell-value" id="reqPOL">-</span>
                        </div>
                        <div class="info-cell span-3">
                            <span class="cell-label">Destination (POD)</span>
                            <span class="cell-value" id="reqPOD">-</span>
                        </div>
                        <div class="info-cell">
                            <span class="cell-label">ETD</span>
                            <span class="cell-value date-value" id="reqETD">-</span>
                        </div>
                        <div class="info-cell">
                            <span class="cell-label">ETA</span>
                            <span class="cell-value date-value" id="reqETA">-</span>
                        </div>
                        <div class="info-cell span-2">
                            <span class="cell-label">Invoice Value</span>
                            <span class="cell-value invoice-value" id="reqInvoice">-</span>
                        </div>
                    </div>
                </section>

                <!-- Cargo Details 테이블 (운송타입별 동적) -->
                <section class="qr-section cargo-section">
                    <h4 class="qr-section-title">Cargo Details</h4>
                    <div class="cargo-table-wrapper">
                        <table class="cargo-table" id="cargoTable">
                            <thead id="cargoTableHead">
                                <!-- 동적 생성 -->
                            </thead>
                            <tbody id="cargoDetailsBody">
                                <tr><td colspan="8" class="no-data">No cargo details</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Additional Services (태그 표시) -->
                <section class="qr-section services-section">
                    <div class="services-header" onclick="BiddingList.toggleAdditionalInfo()">
                        <h4 class="qr-section-title">Additional Services</h4>
                        <div class="service-tags">
                            <span class="svc-tag" id="tagExportCC">Export CC</span>
                            <span class="svc-tag" id="tagImportCC">Import CC</span>
                            <span class="svc-tag" id="tagInsurance">Insurance</span>
                            <span class="svc-tag" id="tagPickup">Pickup</span>
                            <span class="svc-tag" id="tagDelivery">Delivery</span>
                        </div>
                        <i class="fas fa-chevron-down toggle-icon" id="additionalToggleIcon"></i>
                    </div>
                    <div class="services-content" id="additionalInfoContent">
                        <div class="services-grid">
                            <div class="svc-item">
                                <span class="svc-label">Export CC</span>
                                <span class="svc-value" id="addExportCC">-</span>
                            </div>
                            <div class="svc-item">
                                <span class="svc-label">Import CC</span>
                                <span class="svc-value" id="addImportCC">-</span>
                            </div>
                            <div class="svc-item">
                                <span class="svc-label">Insurance</span>
                                <span class="svc-value" id="addInsurance">-</span>
                            </div>
                            <div class="svc-item">
                                <span class="svc-label">Pickup</span>
                                <span class="svc-value" id="addPickup">-</span>
                                <span class="svc-addr" id="addPickupAddr"></span>
                            </div>
                            <div class="svc-item">
                                <span class="svc-label">Delivery</span>
                                <span class="svc-value" id="addDelivery">-</span>
                                <span class="svc-addr" id="addDeliveryAddr"></span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Special Remarks -->
                <section class="qr-section remarks-section" id="remarksSection" style="display: none;">
                    <h4 class="qr-section-title">Special Remarks</h4>
                    <div class="remarks-content" id="reqRemarks">-</div>
                </section>

                <!-- Rates 입력 테이블 -->
                <section class="qr-section rates-section">
                    <div class="rates-header">
                        <h4 class="qr-section-title"><span class="required-mark">*</span> Rates</h4>
                        <button type="button" class="btn-add-row" onclick="BiddingList.addLineItem()">
                            <i class="fas fa-plus"></i> Add Row
                        </button>
                    </div>
                    
                    <div class="rates-table-wrapper">
                        <table class="rates-table">
                            <thead>
                                <tr class="header-row">
                                    <th class="col-del"></th>
                                    <th class="col-code">Code</th>
                                    <th class="col-category">Category</th>
                                    <th class="col-unit">Unit</th>
                                    <th class="col-qty-sm">Qty</th>
                                    <th class="col-rate">Rate</th>
                                    <th class="col-currency">Curr</th>
                                    <th class="col-tax">Tax</th>
                                    <th class="col-vat">VAT%</th>
                                    <th class="col-amount-lg">Amount (USD)</th>
                                </tr>
                            </thead>
                            <tbody id="bidLineItemsBody">
                                <!-- 동적 생성 -->
                            </tbody>
                            <tfoot>
                                <tr class="total-row">
                                    <td colspan="9" class="total-label">Total Amount (USD)</td>
                                    <td class="total-amount">$ <span id="bidTotalAmount">0.00</span></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </section>

                <!-- 운송 정보 입력 -->
                <section class="qr-section transport-section">
                    <h4 class="qr-section-title">Transport Details</h4>
                    <div class="transport-grid">
                        <div class="transport-item">
                            <label class="transport-label">ETD</label>
                            <input type="text" class="transport-input readonly" id="bidETD" readonly>
                        </div>
                        <div class="transport-item">
                            <label class="transport-label">ETA (예정)</label>
                            <input type="date" class="transport-input" id="bidETA" onchange="BiddingList.calculateTT()">
                        </div>
                        <div class="transport-item">
                            <label class="transport-label" id="carrierLabel">Carrier</label>
                            <input type="text" class="transport-input" id="bidCarrier" placeholder="선사/항공사명">
                        </div>
                        <div class="transport-item">
                            <label class="transport-label">T/T</label>
                            <input type="text" class="transport-input readonly" id="bidTT" readonly placeholder="자동계산">
                        </div>
                        <div class="transport-item">
                            <label class="transport-label">견적 유효기간</label>
                            <input type="date" class="transport-input" id="bidValidity">
                        </div>
                    </div>
                </section>

                <!-- 비고 -->
                <section class="qr-section remark-input-section">
                    <h4 class="qr-section-title">Remarks</h4>
                    <textarea class="remark-textarea" id="bidRemark" placeholder="추가 조건이나 비고 사항..."></textarea>
                </section>
            </div>

            <!-- Footer: SAVE / SUBMIT -->
            <div class="modal-footer quote-footer">
                <button class="action-btn cancel-btn" onclick="BiddingList.closeBidModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <div class="footer-actions">
                    <button class="action-btn save-btn" id="bidSaveBtn" onclick="BiddingList.saveBid()">
                        <i class="fas fa-save"></i> <span id="saveBtnText">Save</span>
                    </button>
                    <button class="action-btn submit-btn" id="bidSubmitBtn" onclick="BiddingList.submitBid()" disabled>
                        <i class="fas fa-paper-plane"></i> Submit
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bidding Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal-content" style="max-width: 640px;">
            <div class="modal-header">
                <h3 class="modal-title">Bidding 상세 - <span id="detailBiddingNo">EXSEA00000</span></h3>
                <button class="modal-close" onclick="BiddingList.closeDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="detailModalBody">
                <!-- Detail content will be inserted here -->
            </div>
            <div class="modal-footer">
                <button class="action-btn secondary" onclick="BiddingList.closeDetailModal()">닫기</button>
                <a class="action-btn primary" id="detailPdfBtn" href="#" target="_blank">
                    <i class="fas fa-file-pdf"></i> RFQ PDF
                </a>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/config/api.js"></script>
    <script src="../js/features/biddingList.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            BiddingList.init();
        });
    </script>
</body>
</html>
