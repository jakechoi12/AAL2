<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAL í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 2rem;
            min-height: 100vh;
        }
        h1 {
            margin-bottom: 1.5rem;
            color: #3b82f6;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #16213e;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .test-section h2 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }
        .test-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: #0f3460;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .test-item.pass { background: #064e3b; }
        .test-item.fail { background: #7f1d1d; }
        .test-item.pending { background: #78350f; }
        .test-item .status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        .test-item.pass .status { background: #10b981; }
        .test-item.fail .status { background: #ef4444; }
        .test-item.pending .status { background: #f59e0b; }
        .test-item .name { flex: 1; }
        .test-item .time { color: #888; font-size: 0.85rem; }
        
        .controls {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        button:hover { background: #2563eb; }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .summary-card {
            background: #16213e;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }
        .summary-card .number {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .summary-card.pass .number { color: #10b981; }
        .summary-card.fail .number { color: #ef4444; }
        .summary-card.pending .number { color: #f59e0b; }
        .summary-card .label { color: #888; margin-top: 0.5rem; }
        
        .iframe-container {
            margin-top: 1rem;
            border-radius: 12px;
            overflow: hidden;
            display: none;
        }
        .iframe-container.visible { display: block; }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #333;
            border-radius: 12px;
        }
        
        .log-container {
            background: #0d0d0d;
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
        }
        .log-entry {
            padding: 0.25rem 0;
            border-bottom: 1px solid #222;
        }
        .log-entry.error { color: #f87171; }
        .log-entry.success { color: #34d399; }
        .log-entry.info { color: #60a5fa; }
        
        .css-status {
            background: #16213e;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .css-status h2 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }
        .css-file-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.5rem;
        }
        .css-file {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #0f3460;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        .css-file.loaded { background: #064e3b; }
        .css-file.error { background: #7f1d1d; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª AAL í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ (v2.0)</h1>
        
        <div class="controls">
            <button onclick="runAllTests()">â–¶ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button onclick="runAPITests()">ğŸ”Œ API í…ŒìŠ¤íŠ¸ë§Œ</button>
            <button onclick="runDOMTests()">ğŸ“¦ DOM í…ŒìŠ¤íŠ¸ë§Œ</button>
            <button onclick="runCSSTests()">ğŸ¨ CSS íŒŒì¼ í…ŒìŠ¤íŠ¸</button>
            <button onclick="toggleIframe()">ğŸ‘ ë©”ì¸ í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸°</button>
            <button onclick="clearLogs()">ğŸ—‘ ë¡œê·¸ ì´ˆê¸°í™”</button>
        </div>
        
        <div class="summary">
            <div class="summary-card pass">
                <div class="number" id="passCount">0</div>
                <div class="label">í†µê³¼</div>
            </div>
            <div class="summary-card fail">
                <div class="number" id="failCount">0</div>
                <div class="label">ì‹¤íŒ¨</div>
            </div>
            <div class="summary-card pending">
                <div class="number" id="pendingCount">0</div>
                <div class="label">ëŒ€ê¸°</div>
            </div>
        </div>
        
        <div class="iframe-container" id="iframeContainer">
            <iframe id="mainFrame" src="about:blank"></iframe>
        </div>
        
        <div class="css-status" id="cssStatus">
            <h2>ğŸ¨ CSS íŒŒì¼ ë¡œë“œ ìƒíƒœ</h2>
            <div class="css-file-list" id="cssFileList">
                <div class="css-file">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”...</div>
            </div>
        </div>
        
        <div class="css-status" id="jsStatus">
            <h2>ğŸ“œ JS ëª¨ë“ˆ ë¡œë“œ ìƒíƒœ</h2>
            <div class="css-file-list" id="jsFileList">
                <div class="css-file">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”Œ API ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
            <div id="apiTests"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“¦ DOM/UI ìš”ì†Œ í…ŒìŠ¤íŠ¸</h2>
            <div id="domTests"></div>
        </div>
        
        <div class="test-section">
            <h2>âš¡ JavaScript í•¨ìˆ˜ í…ŒìŠ¤íŠ¸</h2>
            <div id="jsTests"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
            <div class="log-container" id="logContainer"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        let mainWindow = null;
        let testResults = { pass: 0, fail: 0, pending: 0 };
        
        // CSS íŒŒì¼ ëª©ë¡ (ë¶„ë¦¬ëœ CSS íŒŒì¼ë“¤)
        const cssFiles = [
            'css/variables.css',
            'css/base.css',
            'css/components/header.css',
            'css/components/buttons.css',
            'css/components/charts.css',
            'css/components/cards.css',
            'css/components/modals.css',
            'css/sections/hero.css',
            'css/sections/market.css',
            'css/sections/tools.css',
            'css/sections/war-room.css',
            'css/sections/news.css',
        ];
        
        // JS íŒŒì¼ ëª©ë¡ (ë¶„ë¦¬ëœ JS ëª¨ë“ˆë“¤)
        const jsFiles = [
            'js/config/constants.js',
            'js/utils/helpers.js',
        ];
        
        // API í…ŒìŠ¤íŠ¸ ì •ì˜
        const apiTestCases = [
            { name: 'ë©”ì¸ í˜ì´ì§€ ë¡œë“œ', endpoint: '/', check: (r) => r.ok },
            { name: 'ì¹´í…Œê³ ë¦¬ API', endpoint: '/api/market/categories', check: (r, d) => d.categories !== undefined },
            { name: 'í™˜ìœ¨ API (USD)', endpoint: '/api/market/indices?type=exchange&itemCode=USD&startDate=20241201&endDate=20241231&cycle=D', check: (r, d) => d.StatisticSearch?.row?.length > 0 },
            { name: 'ê¸ˆë¦¬ API (ê¸°ì¤€ê¸ˆë¦¬)', endpoint: '/api/market/indices?type=interest&startDate=20240101&endDate=20241231&cycle=D', check: (r, d) => !d.error },
            { name: 'ë¬¼ê°€ API', endpoint: '/api/market/indices?type=inflation&itemCode=CPI_TOTAL&startDate=20240101&endDate=20241231&cycle=M', check: (r, d) => !d.error },
            { name: 'GDP API', endpoint: '/api/market/indices?type=gdp&itemCode=10101&startDate=20230101&endDate=20241231&cycle=A', check: (r, d) => !d.error },
            { name: 'ìˆ˜ì¶œì… API', endpoint: '/api/market/indices?type=trade&itemCode=EXPORT_USD&startDate=20240101&endDate=20241231&cycle=M', check: (r, d) => !d.error },
            { name: 'Global Alerts API', endpoint: '/api/global-alerts?max_alerts=10', check: (r, d) => d.alerts !== undefined },
            { name: 'ë‰´ìŠ¤ API', endpoint: '/api/news', check: (r, d) => Array.isArray(d) && d.length > 0 },
            { name: 'Google Maps API Key', endpoint: '/api/config/google-maps-key', check: (r, d) => d.apiKey !== undefined || r.status === 404 },
        ];
        
        // DOM í…ŒìŠ¤íŠ¸ ì •ì˜ (ì—…ë°ì´íŠ¸ë¨)
        const domTestCases = [
            { name: 'Header ìš”ì†Œ', selector: 'header', check: (el) => el !== null },
            { name: 'Navigation ë©”ë‰´', selector: 'nav ul li', check: (els) => els.length >= 4 },
            { name: 'Hero ì„¹ì…˜', selector: '.hero h1', check: (el) => el !== null },
            { name: 'Market íƒ­ ë²„íŠ¼', selector: '.tab-btn', check: (els) => els.length >= 2 },
            { name: 'Product ë©”ë‰´ (7ê°œ í•­ëª©)', selector: '.product-menu li', check: (els) => els.length >= 7 },
            { name: 'Economy íŒ¨ë„', selector: '#economy-panel', check: (el) => el !== null },
            { name: 'ê¸ˆë¦¬ íŒ¨ë„', selector: '#interest-rates-panel', check: (el) => el !== null },
            { name: 'ë¬¼ê°€ íŒ¨ë„', selector: '#inflation-panel', check: (el) => el !== null },
            { name: 'GDP íŒ¨ë„', selector: '#gdp-panel', check: (el) => el !== null },
            { name: 'ìˆ˜ì¶œì… íŒ¨ë„', selector: '#trade-panel', check: (el) => el !== null },
            { name: 'ê³ ìš© íŒ¨ë„', selector: '#employment-panel', check: (el) => el !== null },
            { name: 'GDP Growth íŒ¨ë„', selector: '#gdp-growth-panel', check: (el) => el !== null },
            { name: 'Logistics íŒ¨ë„', selector: '#logistics-panel', check: (el) => el !== null },
            { name: 'War Room ì„¹ì…˜', selector: '#war-room', check: (el) => el !== null },
            { name: 'Tools ì„¹ì…˜', selector: '#tools-apps', check: (el) => el !== null },
            { name: 'News ì„¹ì…˜', selector: '#news', check: (el) => el !== null },
            { name: 'Footer', selector: 'footer', check: (el) => el !== null },
        ];
        
        // JavaScript í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì •ì˜ (ì—…ë°ì´íŠ¸ë¨)
        const jsTestCases = [
            { name: 'switchTab í•¨ìˆ˜', check: () => typeof mainWindow?.switchTab === 'function' },
            { name: 'switchProduct í•¨ìˆ˜', check: () => typeof mainWindow?.switchProduct === 'function' },
            { name: 'toggleCurrency í•¨ìˆ˜', check: () => typeof mainWindow?.toggleCurrency === 'function' },
            { name: 'updateChart í•¨ìˆ˜', check: () => typeof mainWindow?.updateChart === 'function' },
            { name: 'initInterestRates í•¨ìˆ˜', check: () => typeof mainWindow?.initInterestRates === 'function' },
            { name: 'initInflation í•¨ìˆ˜', check: () => typeof mainWindow?.initInflation === 'function' },
            { name: 'initGDP í•¨ìˆ˜', check: () => typeof mainWindow?.initGDP === 'function' },
            { name: 'initTrade í•¨ìˆ˜', check: () => typeof mainWindow?.initTrade === 'function' },
            { name: 'initGlobalAlarmMap í•¨ìˆ˜', check: () => typeof mainWindow?.initGlobalAlarmMap === 'function' },
            { name: 'loadGoogleMapsAPI í•¨ìˆ˜', check: () => typeof mainWindow?.loadGoogleMapsAPI === 'function' },
            { name: 'exchangeRates ì „ì—­ ë³€ìˆ˜', check: () => mainWindow?.exchangeRates !== undefined },
            { name: 'activeCurrencies ì „ì—­ ë³€ìˆ˜', check: () => Array.isArray(mainWindow?.activeCurrencies) },
            { name: 'API_BASE ì„¤ì •', check: () => mainWindow?.API_BASE !== undefined },
        ];
        
        function log(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            log('ë¡œê·¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
        
        function updateSummary() {
            document.getElementById('passCount').textContent = testResults.pass;
            document.getElementById('failCount').textContent = testResults.fail;
            document.getElementById('pendingCount').textContent = testResults.pending;
        }
        
        function createTestItem(name, status = 'pending', time = '') {
            const item = document.createElement('div');
            item.className = `test-item ${status}`;
            item.innerHTML = `
                <div class="status">${status === 'pass' ? 'âœ“' : status === 'fail' ? 'âœ—' : 'â—‹'}</div>
                <div class="name">${name}</div>
                <div class="time">${time}</div>
            `;
            return item;
        }
        
        function updateTestItem(container, index, status, time) {
            const items = container.children;
            if (items[index]) {
                items[index].className = `test-item ${status}`;
                items[index].querySelector('.status').textContent = status === 'pass' ? 'âœ“' : status === 'fail' ? 'âœ—' : 'â—‹';
                items[index].querySelector('.time').textContent = time;
            }
        }
        
        async function runCSSTests() {
            log('CSS íŒŒì¼ ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            const container = document.getElementById('cssFileList');
            container.innerHTML = '';
            
            let passCount = 0;
            let failCount = 0;
            
            for (const file of cssFiles) {
                const div = document.createElement('div');
                div.className = 'css-file';
                
                try {
                    const response = await fetch(`${API_BASE}/${file}`);
                    if (response.ok) {
                        div.className = 'css-file loaded';
                        div.innerHTML = `âœ“ ${file}`;
                        passCount++;
                        log(`âœ“ CSS ë¡œë“œ: ${file}`, 'success');
                    } else {
                        div.className = 'css-file error';
                        div.innerHTML = `âœ— ${file} (HTTP ${response.status})`;
                        failCount++;
                        log(`âœ— CSS ë¡œë“œ ì‹¤íŒ¨: ${file} (HTTP ${response.status})`, 'error');
                    }
                } catch (error) {
                    div.className = 'css-file error';
                    div.innerHTML = `âœ— ${file} (Error)`;
                    failCount++;
                    log(`âœ— CSS ë¡œë“œ ì—ëŸ¬: ${file} - ${error.message}`, 'error');
                }
                
                container.appendChild(div);
            }
            
            log(`CSS í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${passCount}ê°œ ë¡œë“œ, ${failCount}ê°œ ì‹¤íŒ¨`, 
                failCount === 0 ? 'success' : 'error');
        }
        
        async function runJSTests() {
            log('JS ëª¨ë“ˆ ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            const container = document.getElementById('jsFileList');
            container.innerHTML = '';
            
            let passCount = 0;
            let failCount = 0;
            
            for (const file of jsFiles) {
                const div = document.createElement('div');
                div.className = 'css-file';
                
                try {
                    const response = await fetch(`${API_BASE}/${file}`);
                    if (response.ok) {
                        div.className = 'css-file loaded';
                        div.innerHTML = `âœ“ ${file}`;
                        passCount++;
                        log(`âœ“ JS ë¡œë“œ: ${file}`, 'success');
                    } else {
                        div.className = 'css-file error';
                        div.innerHTML = `âœ— ${file} (HTTP ${response.status})`;
                        failCount++;
                        log(`âœ— JS ë¡œë“œ ì‹¤íŒ¨: ${file} (HTTP ${response.status})`, 'error');
                    }
                } catch (error) {
                    div.className = 'css-file error';
                    div.innerHTML = `âœ— ${file} (Error)`;
                    failCount++;
                    log(`âœ— JS ë¡œë“œ ì—ëŸ¬: ${file} - ${error.message}`, 'error');
                }
                
                container.appendChild(div);
            }
            
            log(`JS í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${passCount}ê°œ ë¡œë“œ, ${failCount}ê°œ ì‹¤íŒ¨`, 
                failCount === 0 ? 'success' : 'error');
        }
        
        async function runAPITests() {
            const container = document.getElementById('apiTests');
            container.innerHTML = '';
            
            log('API í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            for (let i = 0; i < apiTestCases.length; i++) {
                const test = apiTestCases[i];
                container.appendChild(createTestItem(test.name));
                testResults.pending++;
                updateSummary();
            }
            
            for (let i = 0; i < apiTestCases.length; i++) {
                const test = apiTestCases[i];
                const startTime = performance.now();
                
                try {
                    const response = await fetch(`${API_BASE}${test.endpoint}`);
                    let data = null;
                    
                    try {
                        data = await response.json();
                    } catch (e) {
                        // JSONì´ ì•„ë‹Œ ì‘ë‹µ (HTML ë“±)
                    }
                    
                    const passed = test.check(response, data);
                    const endTime = performance.now();
                    const duration = `${(endTime - startTime).toFixed(0)}ms`;
                    
                    testResults.pending--;
                    if (passed) {
                        testResults.pass++;
                        log(`âœ“ ${test.name} - ${duration}`, 'success');
                    } else {
                        testResults.fail++;
                        log(`âœ— ${test.name} - ì‹¤íŒ¨`, 'error');
                    }
                    
                    updateTestItem(container, i, passed ? 'pass' : 'fail', duration);
                    updateSummary();
                    
                } catch (error) {
                    testResults.pending--;
                    testResults.fail++;
                    log(`âœ— ${test.name} - ${error.message}`, 'error');
                    updateTestItem(container, i, 'fail', 'Error');
                    updateSummary();
                }
            }
            
            log('API í…ŒìŠ¤íŠ¸ ì™„ë£Œ!', 'info');
        }
        
        async function runDOMTests() {
            const container = document.getElementById('domTests');
            container.innerHTML = '';
            
            log('DOM í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            // iframe ë¡œë“œ
            const iframe = document.getElementById('mainFrame');
            
            if (!iframe.src.includes('localhost:5000') || iframe.src === 'about:blank') {
                log('ë©”ì¸ í˜ì´ì§€ ë¡œë“œ ì¤‘...', 'info');
                iframe.src = API_BASE;
                
                await new Promise((resolve) => {
                    iframe.onload = () => {
                        // DOMContentLoadedê°€ ë°œìƒí•  ë•Œê¹Œì§€ ëŒ€ê¸°
                        const doc = iframe.contentDocument || iframe.contentWindow.document;
                        if (doc.readyState === 'complete') {
                            // ì´ë¯¸ ë¡œë“œ ì™„ë£Œë˜ì—ˆìœ¼ë©´ ì¦‰ì‹œ resolve
                            resolve();
                        } else {
                            // DOMContentLoaded ì´ë²¤íŠ¸ ëŒ€ê¸°
                            doc.addEventListener('DOMContentLoaded', resolve, { once: true });
                        }
                    };
                    setTimeout(resolve, 8000); // 8ì´ˆ íƒ€ì„ì•„ì›ƒ
                });
                
                await new Promise(resolve => setTimeout(resolve, 2000)); // ì¶”ê°€ ëŒ€ê¸°
            }
            
            try {
                mainWindow = iframe.contentWindow;
            } catch (e) {
                log('iframe ì ‘ê·¼ ì‹¤íŒ¨ (CORS)', 'error');
            }
            
            for (let i = 0; i < domTestCases.length; i++) {
                const test = domTestCases[i];
                container.appendChild(createTestItem(test.name));
                testResults.pending++;
                updateSummary();
            }
            
            // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            for (let i = 0; i < domTestCases.length; i++) {
                const test = domTestCases[i];
                
                try {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    const elements = doc.querySelectorAll(test.selector);
                    const element = elements.length === 0 ? null : (elements.length === 1 ? elements[0] : elements);
                    
                    const passed = test.check(element);
                    
                    testResults.pending--;
                    if (passed) {
                        testResults.pass++;
                        log(`âœ“ ${test.name}`, 'success');
                    } else {
                        testResults.fail++;
                        log(`âœ— ${test.name} - ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`, 'error');
                    }
                    
                    updateTestItem(container, i, passed ? 'pass' : 'fail', '');
                    updateSummary();
                    
                } catch (error) {
                    testResults.pending--;
                    testResults.fail++;
                    log(`âœ— ${test.name} - ${error.message}`, 'error');
                    updateTestItem(container, i, 'fail', 'Error');
                    updateSummary();
                }
            }
            
            log('DOM í…ŒìŠ¤íŠ¸ ì™„ë£Œ!', 'info');
        }
        
        async function runJSFuncTests() {
            const container = document.getElementById('jsTests');
            container.innerHTML = '';
            
            log('JavaScript í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            const iframe = document.getElementById('mainFrame');
            
            // iframeì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¨¼ì € ë¡œë“œ
            if (!iframe.src.includes('localhost:5000') || iframe.src === 'about:blank') {
                log('ë©”ì¸ í˜ì´ì§€ ë¡œë“œ ì¤‘ (JS í…ŒìŠ¤íŠ¸ìš©)...', 'info');
                iframe.src = API_BASE;
                
                await new Promise((resolve) => {
                    iframe.onload = () => {
                        const doc = iframe.contentDocument || iframe.contentWindow.document;
                        
                        // ì´ë¯¸ ë¡œë“œ ì™„ë£Œëœ ê²½ìš°
                        if (doc.readyState === 'complete') {
                            log('í˜ì´ì§€ ì´ë¯¸ ë¡œë“œ ì™„ë£Œë¨', 'info');
                            // DOMContentLoadedê°€ ì´ë¯¸ ë°œìƒí–ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•½ê°„ ëŒ€ê¸° í›„ resolve
                            setTimeout(resolve, 500);
                        } else {
                            // DOMContentLoaded ì´ë²¤íŠ¸ ëŒ€ê¸°
                            log('DOMContentLoaded ëŒ€ê¸° ì¤‘...', 'info');
                            doc.addEventListener('DOMContentLoaded', () => {
                                log('DOMContentLoaded ë°œìƒ', 'success');
                                resolve();
                            }, { once: true });
                        }
                    };
                    setTimeout(() => {
                        log('í˜ì´ì§€ ë¡œë“œ íƒ€ì„ì•„ì›ƒ', 'error');
                        resolve();
                    }, 8000); // 8ì´ˆ íƒ€ì„ì•„ì›ƒ
                });
                
                // DOMContentLoaded í›„ ì¶”ê°€ ëŒ€ê¸° (í•¨ìˆ˜ ë°”ì¸ë”© ì™„ë£Œ ëŒ€ê¸°)
                log('í•¨ìˆ˜ ë°”ì¸ë”© ëŒ€ê¸° ì‹œì‘...', 'info');
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
            
            try {
                mainWindow = iframe.contentWindow;
            } catch (e) {
                log('iframe ì ‘ê·¼ ì‹¤íŒ¨ - JS í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ', 'error');
                return;
            }
            
            for (let i = 0; i < jsTestCases.length; i++) {
                const test = jsTestCases[i];
                container.appendChild(createTestItem(test.name));
                testResults.pending++;
                updateSummary();
            }
            
            // í•¨ìˆ˜ ë°”ì¸ë”© ì™„ë£Œê¹Œì§€ ëŒ€ê¸° (í´ë§ ë°©ì‹)
            log('í•¨ìˆ˜ ë°”ì¸ë”© ëŒ€ê¸° ì¤‘...', 'info');
            let bindCheckCount = 0;
            const maxBindChecks = 50; // ìµœëŒ€ 5ì´ˆ ëŒ€ê¸° (50 * 100ms)
            
            while (bindCheckCount < maxBindChecks) {
                // ì£¼ìš” í•¨ìˆ˜ë“¤ì´ ë°”ì¸ë”©ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (mainWindow?.switchTab && 
                    mainWindow?.switchProduct && 
                    mainWindow?.toggleCurrency && 
                    mainWindow?.updateChart &&
                    mainWindow?.initInterestRates &&
                    mainWindow?.initInflation &&
                    mainWindow?.initGDP &&
                    mainWindow?.initTrade &&
                    mainWindow?.initGlobalAlarmMap) {
                    log(`í•¨ìˆ˜ ë°”ì¸ë”© ì™„ë£Œ (${bindCheckCount * 100}ms í›„)`, 'success');
                    break;
                }
                await new Promise(resolve => setTimeout(resolve, 100));
                bindCheckCount++;
            }
            
            if (bindCheckCount >= maxBindChecks) {
                log('âš  í•¨ìˆ˜ ë°”ì¸ë”© íƒ€ì„ì•„ì›ƒ - ì¼ë¶€ í•¨ìˆ˜ê°€ ë°”ì¸ë”©ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
                // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
                log(`ë””ë²„ê¹…: switchTab=${typeof mainWindow?.switchTab}, switchProduct=${typeof mainWindow?.switchProduct}`, 'info');
            }
            
            for (let i = 0; i < jsTestCases.length; i++) {
                const test = jsTestCases[i];
                
                try {
                    const passed = test.check();
                    
                    testResults.pending--;
                    if (passed) {
                        testResults.pass++;
                        log(`âœ“ ${test.name}`, 'success');
                    } else {
                        testResults.fail++;
                        // ì‹¤íŒ¨í•œ í•¨ìˆ˜ì˜ ìƒì„¸ ì •ë³´ ì¶œë ¥
                        const funcName = test.name.replace(' í•¨ìˆ˜', '').replace(' ì „ì—­ ë³€ìˆ˜', '').replace(' ì„¤ì •', '');
                        log(`âœ— ${test.name} - typeof: ${typeof mainWindow?.[funcName]}`, 'error');
                    }
                    
                    updateTestItem(container, i, passed ? 'pass' : 'fail', '');
                    updateSummary();
                    
                } catch (error) {
                    testResults.pending--;
                    testResults.fail++;
                    log(`âœ— ${test.name} - ${error.message}`, 'error');
                    updateTestItem(container, i, 'fail', 'Error');
                    updateSummary();
                }
            }
            
            log('JavaScript í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!', 'info');
        }
        
        async function runAllTests() {
            testResults = { pass: 0, fail: 0, pending: 0 };
            updateSummary();
            
            log('========== ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘ ==========', 'info');
            
            await runCSSTests();
            await runJSModuleFileTests();
            await runAPITests();
            await runDOMTests();
            await runJSFunctionTests();
            
            log('========== ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ==========', 'info');
            log(`ê²°ê³¼: í†µê³¼ ${testResults.pass}, ì‹¤íŒ¨ ${testResults.fail}`, 
                testResults.fail === 0 ? 'success' : 'error');
        }
        
        // runJSTestsê°€ JS ëª¨ë“ˆ íŒŒì¼ í…ŒìŠ¤íŠ¸, runJSFunctionTestsê°€ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
        async function runJSModuleFileTests() {
            await runJSTests();
        }
        
        async function runJSFunctionTests() {
            await runJSFuncTests();
        }
        
        function toggleIframe() {
            const container = document.getElementById('iframeContainer');
            const iframe = document.getElementById('mainFrame');
            
            if (container.classList.contains('visible')) {
                container.classList.remove('visible');
            } else {
                container.classList.add('visible');
                if (iframe.src === 'about:blank') {
                    iframe.src = API_BASE;
                }
            }
        }
        
        // ì´ˆê¸° ë¡œê·¸
        log('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. "ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'info');
    </script>
</body>
</html>
